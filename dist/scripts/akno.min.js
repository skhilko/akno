"use strict";function Akno(a,b){this._handlers={},this.options=applyDefaults(b,this.defaults),this.element=a,this._render(),this.closeButton=a.querySelector(".akno-action-close"),this._createOverlay(),this._on("click",this.closeButton,this.close),this._on("keydown",this.dialog,this._escKeyHandler),this._on("keydown",this.dialog,this._tabKeyHandler),aknoInstances++}function setFocus(a){var b=a.querySelector("[autofocus]");if(b)return b.focus(),void 0;var c=getTabbables(a,!0);return c.length?(c[0].focus(),void 0):(a.focus(),void 0)}function isVisible(a){return"hidden"!==window.getComputedStyle(a).visibility?a.offsetWidth>0&&a.offsetHeight>0:void 0}function getTabbables(a,b){for(var c=[],d=a.querySelectorAll("input,select,button,textarea,object,a"),e=0,f=d.length;f>e;e++){var g=d[e],h=g.tabIndex>=0;if(isVisible(g)){var i=g.nodeName.toLowerCase();"a"===i?(h||g.href.length)&&c.push(g):h&&!g.disabled&&c.push(g)}if(b&&1===c.length)return c}return c}function addClass(a,b){if(a.classList)return a.classList.add(b),void 0;var c=" ";a.className&&(c=(" "+a.className+" ").replace(REGEX_CLASS_SEPARATOR," ")),c.indexOf(" "+b+" ")<0&&(c+=b+" "),a.className=c.trim()}function removeClass(a,b){if(a.classList)return a.classList.remove(b),void 0;var c=" ";a.className&&(c=(" "+a.className+" ").replace(REGEX_CLASS_SEPARATOR," ")),c.indexOf(" "+b+" ")>=0&&(c=c.replace(" "+b+" "," ")),a.className=b?c.trim():""}function applyDefaults(a,b){var c={};for(var d in b)c[d]=a&&a[d]||b[d];return c}function getTransitionEndEventName(){var a,b={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in b)if(void 0!==document.body.style[a])return b[a]}function getUid(a){var b=a[UID];return b||(b=generateUid(),a[UID]=b),b}function generateUid(){return""+_uid++}var defaults={effect:"scale-up",header:"Modal Window"};Akno.prototype.open=function(){TRANSITION_END_EVENT&&this._on(TRANSITION_END_EVENT,this.dialog,this._openAnimationHandler),addClass(this.dialog,"akno-state-visible"),TRANSITION_END_EVENT||(this._initFocus(),this._trigger("akno-open"))},Akno.prototype.close=function(){this._lastActive&&(this._lastActive.focus(),this._lastActive!==document.activeElement&&document.activeElement.blur(),this._lastActive=null),removeClass(this.dialog,"akno-state-visible"),this._trigger("akno-close")},Akno.prototype.destroy=function(){this._originalPosition.parent.insertBefore(this.element,this._originalPosition.next),this._handlers=null,this._destroyOverlay(),document.body.removeChild(this.dialog),aknoInstances--},Akno.prototype._render=function(){var a=this.element;this._originalPosition={parent:a.parentNode,next:a.nextElementSibling};var b=document.createElement("div");b.innerHTML=tmpl.dialog({header:this.options.header,effect:EFFECTS[this.options.effect]});var c=b.querySelector(".akno-body");c.appendChild(a),this.content=c,this.dialog=document.body.insertBefore(b.firstChild,document.body.firstChild)},Akno.prototype._on=function(a,b,c){if(a&&b){var d=getUid(c),e=getUid(b);c=c.bind(this),c[UID]=d;var f=this._handlers[e];f&&f.length||(f=[],this._handlers[e]=f),f.push({eventName:a,handler:c}),b.addEventListener(a,c)}},Akno.prototype._off=function(a,b,c){var d,e=this._handlers[getUid(b)];if(e)for(var f=0,g=e.length;g>f;f++)d=e[f],d.eventName===a&&getUid(d.handler)===getUid(c)&&(b.removeEventListener(a,d.handler),e.splice(f,1),g--)},Akno.prototype._trigger=function(a){var b=document.createEvent("CustomEvent");b.initEvent(a,!0,!0),this.element.dispatchEvent(b)},Akno.prototype._createOverlay=function(){var a;aknoInstances?a=document.getElementById("akno_overlay"):(a=document.createElement("div"),a.id="akno_overlay",a.className="akno-overlay",document.body.appendChild(a)),this.overlay=a},Akno.prototype._initFocus=function(){this._lastActive=document.activeElement,setFocus(this.dialog)},Akno.prototype._destroyOverlay=function(){1===aknoInstances&&document.body.removeChild(this.overlay)},Akno.prototype._openAnimationHandler=function(){this._off(TRANSITION_END_EVENT,this.dialog,this._openAnimationHandler),this._initFocus(),this._trigger("akno-open")},Akno.prototype._escKeyHandler=function(a){return a.keyCode===KEY_CODE_ESCAPE?(a.preventDefault(),this.close(),void 0):void 0},Akno.prototype._tabKeyHandler=function(a){if(a.keyCode===TAB_CODE_ESCAPE){var b=getTabbables(this.content);if(b.length){var c=b[0],d=b[b.length-1];a.target!==d&&a.target!==this.dialog||a.shiftKey?a.target!==c&&a.target!==this.dialog||!a.shiftKey||(d.focus(),a.preventDefault()):(c.focus(),a.preventDefault())}else this.dialog.focus()}},Akno.prototype.defaults=defaults;var KEY_CODE_ESCAPE=27,TAB_CODE_ESCAPE=9,REGEX_CLASS_SEPARATOR=/[\t\r\n\f]/g,UID="aknouid",EFFECTS={"scale-up":"akno-fx-scale-up","slide-in-right":"akno-fx-slide-in-right","slide-in-bottom":"akno-fx-slide-in-bottom",newspaper:"akno-fx-newspaper",fall:"akno-fx-fall","side-fall":"akno-fx-side-fall","sticky-top":"akno-fx-sticky-top","flip-hor":"akno-fx-flip-hor","flip-vert":"akno-fx-flip-vert",sign:"akno-fx-sign","scale-down":"akno-fx-scale-down","just-me":"akno-fx-just-me",split:"akno-fx-split","rotate-bottom":"akno-fx-rotate-bottom","rotate-left":"akno-fx-rotate-left"},aknoInstances=0,_uid=1,TRANSITION_END_EVENT=getTransitionEndEventName();window.Akno=Akno;